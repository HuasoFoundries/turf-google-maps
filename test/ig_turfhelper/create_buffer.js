(function (QUnit) {


    QUnit.module("turfHelper Create Buffer");


    QUnit.test('turfHelper.createbuffer should be of type function', function (assert) {
        assert.equal(typeof turfHelper.createbuffer, 'function', 'turfHelper.createbuffer should be of type function');
    });
    QUnit.test('turfHelper.createbuffer should create a correct buffer from a  google.maps.Polygon', function (assert) {
        var done = assert.async();

        var runtest = function (gmaps) {

            var gmPolygon = new gmaps.Polygon({
                paths: [{
                    "lng": -46.64726257324219,
                    "lat": -23.606149421193066
                }, {
                    "lng": -46.605377197265625,
                    "lat": -23.611811980492
                }, {
                    "lng": -46.57585144042969,
                    "lat": -23.618103426139445
                }, {
                    "lng": -46.56280517578125,
                    "lat": -23.59922818324089
                }, {
                    "lng": -46.56211853027344,
                    "lat": -23.533772983255645
                }, {
                    "lng": -46.643829345703125,
                    "lat": -23.514255992003548
                }, {
                    "lng": -46.68571472167969,
                    "lat": -23.532513909870513
                }, {
                    "lng": -46.715240478515625,
                    "lat": -23.581608838551873
                }, {
                    "lng": -46.676788330078125,
                    "lat": -23.57279827909608
                }]
            });


            var featurePolygon = {
                "geometry": {
                    "coordinates": [
                        [
                            [-46.650817915, -23.608792458],
                            [-46.650224453, -23.609348357],
                            [-46.649529203, -23.609794337],
                            [-46.648756057, -23.610115071],
                            [-46.64793158, -23.610299534],
                            [-46.60623151, -23.615938171],
                            [-46.576888692, -23.622191424],
                            [-46.575955239, -23.622299371],
                            [-46.575017398, -23.622230306],
                            [-46.574114738, -23.621987142],
                            [-46.573285342, -23.621580134],
                            [-46.572564203, -23.621026451],
                            [-46.571981746, -23.620349454],
                            [-46.558935253, -23.601473528],
                            [-46.558550783, -23.600783373],
                            [-46.558311317, -23.600040215],
                            [-46.558225016, -23.599269382],
                            [-46.55754095, -23.533812343],
                            [-46.557614723, -23.533021602],
                            [-46.557849534, -23.532257732],
                            [-46.558236984, -23.531548047],
                            [-46.558763214, -23.530917921],
                            [-46.559409406, -23.530389884],
                            [-46.560152453, -23.529982814],
                            [-46.560965787, -23.529711264],
                            [-46.642675049, -23.510196928],
                            [-46.643462361, -23.510074723],
                            [-46.644260847, -23.510079916],
                            [-46.645046182, -23.510212347],
                            [-46.645794438, -23.510467981],
                            [-46.687677742, -23.528725964],
                            [-46.688488211, -23.52917901],
                            [-46.689179244, -23.529775668],
                            [-46.689721085, -23.530490245],
                            [-46.719246598, -23.579583358],
                            [-46.719596544, -23.580326409],
                            [-46.71978423, -23.581117232],
                            [-46.719802661, -23.58192637],
                            [-46.719651148, -23.582723684],
                            [-46.71933533, -23.583479473],
                            [-46.718866968, -23.584165585],
                            [-46.718263506, -23.58475646],
                            [-46.71754742, -23.585230084],
                            [-46.716745384, -23.585568812],
                            [-46.715887277, -23.585760023],
                            [-46.715005066, -23.58579659],
                            [-46.714131618, -23.585677148],
                            [-46.678505589, -23.577515508],
                            [-46.650817915, -23.608792458]
                        ]
                    ],
                    "type": "Polygon"
                },
                "properties": {},
                "type": "Feature"
            };


            var result = turfHelper.createbuffer(gmPolygon, 'feature', 500, 'meters', 64);

            var simplified_result_geom = result.geometry.coordinates[0].map(function (point) {
                return [Math.round(point[0] * 1000000000) / 1000000000, Math.round(point[1] * 1000000000) / 1000000000];
            });
            result.geometry.coordinates = [
                simplified_result_geom
            ];


            assert.deepEqual(result, featurePolygon, 'turfHelper.createbuffer should create a correct buffer from a  google.maps.Polygon');
            done();
        };
        if (window.gmaps.then) {
            window.gmaps.then(function (gmaps) {
                runtest(gmaps);
            })
        } else {
            runtest(window.gmaps);
        }
    });
})(QUnit);
