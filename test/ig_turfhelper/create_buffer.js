(function (QUnit) {


    QUnit.module("turfHelper Create Buffer");


    QUnit.test('turfHelper.createbuffer should be of type function', function (assert) {
        assert.equal(typeof turfHelper.createbuffer, 'function', 'turfHelper.createbuffer should be of type function');
    });
    QUnit.test('turfHelper.createbuffer should create a correct buffer from a  google.maps.Polygon', function (assert) {
        var done = assert.async();

        var runtest = function (gmaps) {

            var gmPolygon = new gmaps.Polygon({
                paths: [{
                    "lng": -46.64726257324219,
                    "lat": -23.606149421193066
                }, {
                    "lng": -46.605377197265625,
                    "lat": -23.611811980492
                }, {
                    "lng": -46.57585144042969,
                    "lat": -23.618103426139445
                }, {
                    "lng": -46.56280517578125,
                    "lat": -23.59922818324089
                }, {
                    "lng": -46.56211853027344,
                    "lat": -23.533772983255645
                }, {
                    "lng": -46.643829345703125,
                    "lat": -23.514255992003548
                }, {
                    "lng": -46.68571472167969,
                    "lat": -23.532513909870513
                }, {
                    "lng": -46.715240478515625,
                    "lat": -23.581608838551873
                }, {
                    "lng": -46.676788330078125,
                    "lat": -23.57279827909608
                }]
            });


            var featurePolygon = {
                "geometry": {
                    "coordinates": [
                        [
                            [-46.650750561, -23.608742467],
                            [-46.678474074, -23.577427931],
                            [-46.714151111, -23.58560236],
                            [-46.715008464, -23.585719769],
                            [-46.715874459, -23.585684053],
                            [-46.716716839, -23.585496543],
                            [-46.717504226, -23.585164222],
                            [-46.718207292, -23.584699468],
                            [-46.718799847, -23.584119591],
                            [-46.719259821, -23.58344619],
                            [-46.719570079, -23.582704346],
                            [-46.719719064, -23.581921692],
                            [-46.719701228, -23.58112738],
                            [-46.719517235, -23.580350997],
                            [-46.719173938, -23.579621462],
                            [-46.689648181, -23.530525791],
                            [-46.689116403, -23.529824757],
                            [-46.688438364, -23.529239344],
                            [-46.687643219, -23.528794726],
                            [-46.645757844, -23.510536292],
                            [-46.645023611, -23.510285588],
                            [-46.644253039, -23.510155694],
                            [-46.643469577, -23.510150562],
                            [-46.64269706, -23.510270348],
                            [-46.560986245, -23.52978793],
                            [-46.560188309, -23.530054586],
                            [-46.559459384, -23.530454187],
                            [-46.558825532, -23.530972445],
                            [-46.558309413, -23.531590828],
                            [-46.557929482, -23.532287228],
                            [-46.557699322, -23.533036743],
                            [-46.557627161, -23.533812577],
                            [-46.558313807, -23.599267758],
                            [-46.558398377, -23.600024096],
                            [-46.558633316, -23.600753272],
                            [-46.559010606, -23.601430406],
                            [-46.572056871, -23.620305331],
                            [-46.572628005, -23.620969285],
                            [-46.573335166, -23.6215123],
                            [-46.574148511, -23.621911464],
                            [-46.575033718, -23.622149933],
                            [-46.575953433, -23.622217645],
                            [-46.576868843, -23.622111744],
                            [-46.606215104, -23.615858738],
                            [-46.647918168, -23.610221],
                            [-46.648727215, -23.610040118],
                            [-46.649485913, -23.609725488],
                            [-46.65016818, -23.609287924],
                            [-46.650750561, -23.608742467]
                        ]
                    ],
                    "type": "Polygon"
                },
                "properties": {},
                "type": "Feature"
            };


            var result = turfHelper.createbuffer(gmPolygon, 'feature', 500, {
                units: 'meters',
                steps: 64
            });

            var simplified_result_geom = result.geometry.coordinates[0].map(function (point) {
                return [Math.round(point[0] * 1000000000) / 1000000000, Math.round(point[1] * 1000000000) / 1000000000];
            });
            result.geometry.coordinates = [
                simplified_result_geom
            ];


            assert.deepEqual(result, featurePolygon, 'turfHelper.createbuffer should create a correct buffer from a  google.maps.Polygon');
            done();
        };
        if (window.gmaps.then) {
            window.gmaps.then(function (gmaps) {
                runtest(gmaps);
            })
        } else {
            runtest(window.gmaps);
        }
    });
})(QUnit);
